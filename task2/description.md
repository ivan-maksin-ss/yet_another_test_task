# TASK2

## Задание
> Задание: Реализовать счетчик вызова скрипта. Было принято решение, хранить данные в файле.
> Вопрос: Какие проблемы имеет данный подход? Как вы их можете решить? (Нельзя использовать другие технологии)

## Решение
1. Предложенный вариант реализации счетчика отличается лаконичностью но не вполне работоспособен так как:
  * Файл с данными счетчика может не существовать или быть недоступным для чтения.
  * В файле могут находиться нечисловые данные
  * Числа в файле могут превышать допустимый максимум целых чисел 
  * Файл недоступен для записи

2. Ниже приведена реализация счетчика в которой решаются вышеупомянутые проблемы.


```php
<?php

/**
 * Задание: 
 *     Реализовать счетчик вызова скрипта. 
 *     Было принято решение, хранить данные в файле.
 */
 
set_exception_handler(function($e) {
	// Программа не может корректно выполниться и требует ручного контроля.
	// Поэтому ошибка логгируется и программа завершается.
	echo "Exception: " . $e->getMessage() . "\n";
	
	// Завершение программы с ненулевым кодом
	exit(1);
});

$filename = './counter.txt';

if (!file_exists($filename)) {
	throw new \Exception('Counter file is not exists.');
}

$data = trim(file_get_contents($filename));

if (preg_match('/^\d+$/', $data) !== 1) {
	throw new \Exception('Counter file contents is not a valid decimal.');
}

$count = bcadd($data, 1);

if (file_put_contents($filename, $count) === FALSE) {
	throw new \Exception('There was error while saving counter value.');
}

echo "Successfull";
```
